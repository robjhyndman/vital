<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Stochastic population forecasting • vital</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Stochastic population forecasting">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vital</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">Introduction to the vital package</a></li>
    <li><a class="dropdown-item" href="../articles/population_forecasting.html">Stochastic population forecasting</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/robjhyndman/vital/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Stochastic population forecasting</h1>
                        <h4 data-toc-skip class="author">Rob J
Hyndman</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/robjhyndman/vital/blob/main/vignettes/population_forecasting.Rmd" class="external-link"><code>vignettes/population_forecasting.Rmd</code></a></small>
      <div class="d-none name"><code>population_forecasting.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.robjhyndman.com/vital/">vital</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fable.tidyverts.org" class="external-link">fable</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2025</span><span class="op">)</span></span></code></pre></div>
<p>The vital package can be used for stochastic population forecasting
with coherent components. This is based on the papers by <span class="citation">Hyndman and Booth (2008)</span> and <span class="citation">Hyndman, Booth, and Yasmeen (2013)</span>. Following
<span class="citation">Hyndman and Booth (2008)</span>, we use the
following demographic growth-balance equations:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>P</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>B</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>D</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>G</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
P_t(x) = P_{t-1}(x) + B_t(x) - D_t(x) + G_t(x)
</annotation></semantics></math> where</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_t(x)</annotation></semantics></math>
is the population at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and age
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">B_t(x)</annotation></semantics></math>
is the number of births at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and age
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">D_t(x)</annotation></semantics></math>
is the number of deaths at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and age
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>,
and</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">G_t(x)</annotation></semantics></math>
is the number of net migrants at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and age
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>.</li>
</ul>
<p>There are slightly different equations for handling the upper age
group, and for baby migrants. See <span class="citation">Hyndman and
Booth (2008)</span> for details.</p>
<p>To simulate future births, deaths and net migrants, we develop three
functional data models for fertility, mortality and migration. The
models for mortality and migration use coherent components, so that the
rates for males and females do not diverge over time.</p>
<p>The following example uses Norwegian data up to 2022, and produces
simulated populations for the ten future years. Different models are
used for each component to demonstrate the flexibility of the package,
but other models can be used as well.</p>
<div class="section level2">
<h2 id="mortality-model">Mortality model<a class="anchor" aria-label="anchor" href="#mortality-model"></a>
</h2>
<p>We use a coherent functional data model <span class="citation">(Hyndman, Booth, and Yasmeen 2013)</span> for the log
mortality rates. To ensure coherence, we compute the geometric mean of
the sex-specific mortality rates and the corresponding ratios, using the
<code><a href="../reference/make_pr.html">make_pr()</a></code> function. The data are smoothed first, and 6
components are used by default in each FDM, although only the first two
are plotted here.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_mortality</span> <span class="op">&lt;-</span> <span class="va">norway_mortality</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Sex</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/smooth_vital.html">smooth_mortality</a></span><span class="op">(</span><span class="va">Mortality</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/make_pr.html">make_pr</a></span><span class="op">(</span><span class="va">.smooth</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html" class="external-link">model</a></span><span class="op">(</span>fdm <span class="op">=</span> <span class="fu"><a href="../reference/FDM.html">FDM</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">.smooth</span><span class="op">)</span>, coherent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fit_mortality</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="population_forecasting_files/figure-html/mortality-1.png" alt="First two components of the functional data model for mortality rates." width="100%"></p>
</div>
<div class="section level2">
<h2 id="fertility-model">Fertility model<a class="anchor" aria-label="anchor" href="#fertility-model"></a>
</h2>
<p>For fertility, we use a functional mean model with a square root
transformation, applied to the last 13 years of data. The plotted model
shows the fitted values on the square root scale.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_fertility</span> <span class="op">&lt;-</span> <span class="va">norway_fertility</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">&gt;</span> <span class="fl">2010</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/smooth_vital.html">smooth_fertility</a></span><span class="op">(</span><span class="va">Fertility</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html" class="external-link">model</a></span><span class="op">(</span>fmean <span class="op">=</span> <span class="fu"><a href="../reference/FMEAN.html">FMEAN</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">.smooth</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fit_fertility</span><span class="op">)</span></span></code></pre></div>
<p><img src="population_forecasting_files/figure-html/fertility-1.png" alt="Fitted values of the functional mean model for fertility rates." width="100%"></p>
</div>
<div class="section level2">
<h2 id="net-migration-model">Net migration model<a class="anchor" aria-label="anchor" href="#net-migration-model"></a>
</h2>
<p>For net migration, we use a coherent functional data model. Because
net migration values can be positive or negative, we can’t take products
and ratios. Instead, we need to compute the means and corresponding
differences using the <code>mean_sd()</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">netmig</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/net_migration.html">net_migration</a></span><span class="op">(</span></span>
<span>  <span class="va">norway_mortality</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Sex</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span>,</span>
<span>  <span class="va">norway_births</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/make_sd.html">make_sd</a></span><span class="op">(</span><span class="va">NetMigration</span><span class="op">)</span></span>
<span><span class="va">fit_migration</span> <span class="op">&lt;-</span> <span class="va">netmig</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html" class="external-link">model</a></span><span class="op">(</span>fdm <span class="op">=</span> <span class="fu"><a href="../reference/FDM.html">FDM</a></span><span class="op">(</span><span class="va">NetMigration</span>, coherent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fit_migration</span><span class="op">)</span></span></code></pre></div>
<p><img src="population_forecasting_files/figure-html/migration-1.png" alt="First two components of the functional data model for net migration." width="100%"></p>
</div>
<div class="section level2">
<h2 id="population-simulation">Population simulation<a class="anchor" aria-label="anchor" href="#population-simulation"></a>
</h2>
<p>The <code><a href="../reference/generate_population.html">generate_population()</a></code> function takes a starting
population, and the three component models, and simulates future
age-sex-specific population values. Here we produce ten replicates of
the future population.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="va">norway_mortality</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Sex</span> <span class="op">!=</span> <span class="st">"Total"</span>, <span class="va">Year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">future</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_population.html">generate_population</a></span><span class="op">(</span></span>
<span>  starting_population <span class="op">=</span> <span class="va">pop</span>,</span>
<span>  mortality_model <span class="op">=</span> <span class="va">fit_mortality</span>,</span>
<span>  fertility_model <span class="op">=</span> <span class="va">fit_fertility</span>,</span>
<span>  migration_model <span class="op">=</span> <span class="va">fit_migration</span>,</span>
<span>  h <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  n_reps <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The first replicate is plotted below, along with the last few years
of historical data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">future</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.rep</span> <span class="op">==</span> <span class="st">"100"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Age</span>, y <span class="op">=</span> <span class="va">Population</span>, group <span class="op">=</span> <span class="va">Year</span>, color <span class="op">=</span> <span class="va">Year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">norway_mortality</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">&gt;</span> <span class="fl">2010</span>, <span class="va">Sex</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">Year</span><span class="op">)</span></span>
<span>  <span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">Sex</span><span class="op">)</span></span></code></pre></div>
<p><img src="population_forecasting_files/figure-html/population_plot-1.png" alt="Simulated population for the first replicate." width="100%"></p>
<p>The simulated populations can be used to compute any quantities that
can be derived from populations numbers by sex and age. For example, the
mean age of the population for the next 10 years</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">future</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Sex</span>, <span class="va">.rep</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Population</span> <span class="op">*</span> <span class="op">(</span><span class="va">Age</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Population</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Sex</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mean_age</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A vital: 20 x 3 [1Y]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Key:     Sex [2]</span></span></span>
<span><span class="co">#&gt;    Sex     Year mean_age</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Female  <span style="text-decoration: underline;">2</span>024     42.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Female  <span style="text-decoration: underline;">2</span>025     42.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Female  <span style="text-decoration: underline;">2</span>026     42.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Female  <span style="text-decoration: underline;">2</span>027     42.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Female  <span style="text-decoration: underline;">2</span>028     42.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Female  <span style="text-decoration: underline;">2</span>029     43.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Female  <span style="text-decoration: underline;">2</span>030     43.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Female  <span style="text-decoration: underline;">2</span>031     43.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Female  <span style="text-decoration: underline;">2</span>032     43.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Female  <span style="text-decoration: underline;">2</span>033     44.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Male    <span style="text-decoration: underline;">2</span>024     40.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Male    <span style="text-decoration: underline;">2</span>025     40.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Male    <span style="text-decoration: underline;">2</span>026     41.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Male    <span style="text-decoration: underline;">2</span>027     41.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> Male    <span style="text-decoration: underline;">2</span>028     41.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> Male    <span style="text-decoration: underline;">2</span>029     41.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> Male    <span style="text-decoration: underline;">2</span>030     42.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> Male    <span style="text-decoration: underline;">2</span>031     42.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> Male    <span style="text-decoration: underline;">2</span>032     42.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> Male    <span style="text-decoration: underline;">2</span>033     42.7</span></span></code></pre></div>
<p>We can also plot population pyramids with prediction intervals. For
example, here is the population pyramid for 2032 with a 95% prediction
interval.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pyramid_2032</span> <span class="op">&lt;-</span> <span class="va">future</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2032</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Population <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">Sex</span> <span class="op">==</span> <span class="st">"Female"</span>, <span class="op">-</span><span class="va">Population</span>, <span class="va">Population</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Age</span>, <span class="va">Sex</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    lo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Population</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>    med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Population</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    hi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Population</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">pyramid_2032</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lo</span>, ymax <span class="op">=</span> <span class="va">hi</span>, colour <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#c14b14"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">med</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#c14b14"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">Sex</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Population"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span>, alpha <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="population_forecasting_files/figure-html/population_pyramid-1.png" alt="Population pyramid for 2032 with 95% prediction intervals." width="100%"></p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-HB08" class="csl-entry">
Hyndman, Rob J, and Heather Booth. 2008. <span>“Stochastic Population
Forecasts Using Functional Data Models for Mortality, Fertility and
Migration.”</span> <em>International J Forecasting</em> 24 (3): 323–42.
<a href="https://robjhyndman.com/publications/stochastic-population-forecasts/" class="external-link">https://robjhyndman.com/publications/stochastic-population-forecasts/</a>.
</div>
<div id="ref-hby" class="csl-entry">
Hyndman, Rob J, Heather Booth, and Farah Yasmeen. 2013. <span>“Coherent
Mortality Forecasting: The Product-Ratio Method with Functional Time
Series Models.”</span> <em>Demography</em> 50 (1): 261–83. <a href="https://robjhyndman.com/publications/coherentfdm/" class="external-link">https://robjhyndman.com/publications/coherentfdm/</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rob Hyndman, Sixian Tang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
